<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jalyboy-baby ( Write Up ) | xiung's doc</title>
    <meta name="description" content="Some documents">
    <meta name="generator" content="VitePress v1.2.2">
    <link rel="preload stylesheet" href="/assets/style.biM7mc3a.css" as="style">
    
    <script type="module" src="/assets/app.FsXuW1iC.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.BwTyoF0R.js">
    <link rel="modulepreload" href="/assets/chunks/theme.DXzPZOCR.js">
    <link rel="modulepreload" href="/assets/writeups_jalyboy-baby.md.B8d4Vje1.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b7f5faf8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-1bc529e5></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-1bc529e5> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b7f5faf8 data-v-894db4ed><div class="VPNavBar has-sidebar top" data-v-894db4ed data-v-db0924c9><div class="wrapper" data-v-db0924c9><div class="container" data-v-db0924c9><div class="title" data-v-db0924c9><div class="VPNavBarTitle has-sidebar" data-v-db0924c9 data-v-0545dc4d><a class="title" href="/" data-v-0545dc4d><!--[--><!--]--><!----><span data-v-0545dc4d>xiung&#39;s doc</span><!--[--><!--]--></a></div></div><div class="content" data-v-db0924c9><div class="content-body" data-v-db0924c9><!--[--><!--]--><div class="VPNavBarSearch search" data-v-db0924c9><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-db0924c9 data-v-5c9a3220><span id="main-nav-aria-label" class="visually-hidden" data-v-5c9a3220>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-5c9a3220 data-v-e4cce88d><!--[--><span data-v-e4cce88d>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/writeups/broken-login.html" tabindex="0" data-v-5c9a3220 data-v-e4cce88d><!--[--><span data-v-e4cce88d>WriteUp</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-db0924c9 data-v-c4a2fccd><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-c4a2fccd data-v-911ea7a7 data-v-e3a15414><span class="check" data-v-e3a15414><span class="icon" data-v-e3a15414><!--[--><span class="vpi-sun sun" data-v-911ea7a7></span><span class="vpi-moon moon" data-v-911ea7a7></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-db0924c9 data-v-21ee45fc data-v-dc7008d0><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-dc7008d0 data-v-aeb16707><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-db0924c9 data-v-316705b9 data-v-9156b75d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9156b75d><span class="vpi-more-horizontal icon" data-v-9156b75d></span></button><div class="menu" data-v-9156b75d><div class="VPMenu" data-v-9156b75d data-v-a004cdd0><!----><!--[--><!--[--><!----><div class="group" data-v-316705b9><div class="item appearance" data-v-316705b9><p class="label" data-v-316705b9>Appearance</p><div class="appearance-action" data-v-316705b9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-316705b9 data-v-911ea7a7 data-v-e3a15414><span class="check" data-v-e3a15414><span class="icon" data-v-e3a15414><!--[--><span class="vpi-sun sun" data-v-911ea7a7></span><span class="vpi-moon moon" data-v-911ea7a7></span><!--]--></span></span></button></div></div></div><div class="group" data-v-316705b9><div class="item social-links" data-v-316705b9><div class="VPSocialLinks social-links-list" data-v-316705b9 data-v-dc7008d0><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-dc7008d0 data-v-aeb16707><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-db0924c9 data-v-d2fa9eb3><span class="container" data-v-d2fa9eb3><span class="top" data-v-d2fa9eb3></span><span class="middle" data-v-d2fa9eb3></span><span class="bottom" data-v-d2fa9eb3></span></span></button></div></div></div></div><div class="divider" data-v-db0924c9><div class="divider-line" data-v-db0924c9></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-b7f5faf8 data-v-0f2d859c><div class="container" data-v-0f2d859c><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-0f2d859c><span class="vpi-align-left menu-icon" data-v-0f2d859c></span><span class="menu-text" data-v-0f2d859c>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-0f2d859c data-v-0b2c1a9e><button data-v-0b2c1a9e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-b7f5faf8 data-v-6828098f><div class="curtain" data-v-6828098f></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-6828098f><span class="visually-hidden" id="sidebar-aria-label" data-v-6828098f> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-6828098f><section class="VPSidebarItem level-0" data-v-6828098f data-v-67df4f51><div class="item" role="button" tabindex="0" data-v-67df4f51><div class="indicator" data-v-67df4f51></div><h2 class="text" data-v-67df4f51>CyberEdu</h2><!----></div><div class="items" data-v-67df4f51><!--[--><div class="VPSidebarItem level-1 is-link" data-v-67df4f51 data-v-67df4f51><div class="item" data-v-67df4f51><div class="indicator" data-v-67df4f51></div><a class="VPLink link link" href="/writeups/broken-login.html" data-v-67df4f51><!--[--><p class="text" data-v-67df4f51>broken-login</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-67df4f51 data-v-67df4f51><div class="item" data-v-67df4f51><div class="indicator" data-v-67df4f51></div><a class="VPLink link link" href="/writeups/file-crawler.html" data-v-67df4f51><!--[--><p class="text" data-v-67df4f51>file-crawler</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-6828098f><div class="VPSidebarItem level-0" data-v-6828098f data-v-67df4f51><div class="item" role="button" tabindex="0" data-v-67df4f51><div class="indicator" data-v-67df4f51></div><p class="text" data-v-67df4f51>picoCTF</p><!----></div><!----></div></div><div class="group" data-v-6828098f><section class="VPSidebarItem level-0 has-active" data-v-6828098f data-v-67df4f51><div class="item" role="button" tabindex="0" data-v-67df4f51><div class="indicator" data-v-67df4f51></div><h2 class="text" data-v-67df4f51>Other</h2><!----></div><div class="items" data-v-67df4f51><!--[--><div class="VPSidebarItem level-1 is-link" data-v-67df4f51 data-v-67df4f51><div class="item" data-v-67df4f51><div class="indicator" data-v-67df4f51></div><a class="VPLink link link" href="/writeups/jalyboy-baby.html" data-v-67df4f51><!--[--><p class="text" data-v-67df4f51>jalyboy-baby</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-b7f5faf8 data-v-d0ae1441><div class="VPDoc has-sidebar has-aside" data-v-d0ae1441 data-v-72115c32><!--[--><!--]--><div class="container" data-v-72115c32><div class="aside" data-v-72115c32><div class="aside-curtain" data-v-72115c32></div><div class="aside-container" data-v-72115c32><div class="aside-content" data-v-72115c32><div class="VPDocAside" data-v-72115c32 data-v-eb0753fd><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-eb0753fd data-v-f88f03df><div class="content" data-v-f88f03df><div class="outline-marker" data-v-f88f03df></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f88f03df>On this page</div><ul class="VPDocOutlineItem root" data-v-f88f03df data-v-c2574ecc><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-eb0753fd></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-72115c32><div class="content-container" data-v-72115c32><!--[--><!--]--><main class="main" data-v-72115c32><div style="position:relative;" class="vp-doc _writeups_jalyboy-baby" data-v-72115c32><div><h1 id="jalyboy-baby-write-up" tabindex="-1">jalyboy-baby ( Write Up ) <a class="header-anchor" href="#jalyboy-baby-write-up" aria-label="Permalink to &quot;jalyboy-baby ( Write Up )&quot;">​</a></h1><p>LineCTF 2024</p><p>原始碼：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JwtController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String ADMIN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String GUEST </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;guest&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String UNKNOWN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;unknown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String FLAG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getenv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;FLAG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Key secretKey </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Keys.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">secretKeyFor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SignatureAlgorithm.HS256);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequestParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">required</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">j</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Model </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String sub </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UNKNOWN;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String jwt_guest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jwts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSubject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GUEST).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">signWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(secretKey).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Jwt jwt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jwts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSigningKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(secretKey).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(j);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Claims claims </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Claims) jwt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSubject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ADMIN)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                sub </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ADMIN;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (claims.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSubject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GUEST)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                sub </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GUEST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//            e.printStackTrace();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jwt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, jwt_guest);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sub&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sub);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (sub.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ADMIN)) model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;flag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, FLAG);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;LINECTF2024 | jalyboy-baby&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;!-- 省略 --</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class=&quot;light&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class=&quot;center&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LINECTF2024 | </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jalyboy-baby</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Hi ${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sub</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}!&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">h2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">#if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flag?has_content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flag is &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">flag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} &amp;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#x1f389;&lt;/code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> href=&quot;/?j=${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">jwt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}&quot; class=&quot;button&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">login as guest&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class=&quot;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> disabled&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">login as admin&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><hr><h3 id="❓-jwt-json-web-token" tabindex="-1">❓ JWT ( Json Web Token ) <a class="header-anchor" href="#❓-jwt-json-web-token" aria-label="Permalink to &quot;❓ JWT ( Json Web Token )&quot;">​</a></h3><p>JWT 分成三個部分</p><p><strong>Header</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;alg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HS256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;typ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;JWT&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Payload</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;sub&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;iat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1422779638</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>Signature</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HMAC_SHA256(</span></span>
<span class="line"><span>  base64urlEncoding(header) + &#39;.&#39; +</span></span>
<span class="line"><span>  base64urlEncoding(payload),</span></span>
<span class="line"><span>  secret</span></span>
<span class="line"><span>)</span></span></code></pre></div><p>最後將三個部分使用 Base64url 加密組成 Token</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64urlEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(header) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64urlEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(payload) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64urlEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signature)</span></span></code></pre></div><p>補充資料：<a href="https://en.wikipedia.org/wiki/JSON_Web_Token" target="_blank" rel="noreferrer">JSON Web Token</a></p><hr><h3 id="🔻-step-1" tabindex="-1">🔻 Step. 1 <a class="header-anchor" href="#🔻-step-1" aria-label="Permalink to &quot;🔻 Step. 1&quot;">​</a></h3><ul><li>點擊 <code>login as guest</code> 後，觀察到封包內出現 <code>j=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJndWVzdCJ9.rUKzvxAwpuro6UF6KETwbMPCLBsPGUScjSEZtQGjfX4</code></li><li>依據原始碼的資訊，判斷出後面的代碼為 JWT 加密後的字串</li></ul><p><img src="https://hackmd.io/_uploads/SkepqDYn0a.png" alt="image"></p><hr><h3 id="🔻-step-2" tabindex="-1">🔻 Step. 2 <a class="header-anchor" href="#🔻-step-2" aria-label="Permalink to &quot;🔻 Step. 2&quot;">​</a></h3><ul><li>根據 <code>header.payload.secret</code> 的格式，將三段分別切成</li></ul><blockquote><p>header = <code>eyJhbGciOiJIUzI1NiJ9</code> payload = <code>eyJzdWIiOiJndWVzdCJ9</code> secret = <code>rUKzvxAwpuro6UF6KETwbMPCLBsPGUScjSEZtQGjfX4</code></p></blockquote><ul><li><em>secret</em> 是由 <em>header</em> 與 <em>payload</em> 使用 <a href="https://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F" target="_blank" rel="noreferrer">HS256</a> 雜湊後的字串</li></ul><div class="warning custom-block"><p class="custom-block-title">WARNING</p><h3 id="雜湊函式-hash-function" tabindex="-1">雜湊函式 Hash Function <a class="header-anchor" href="#雜湊函式-hash-function" aria-label="Permalink to &quot;雜湊函式 Hash Function&quot;">​</a></h3><ul><li>由雜湊值是無法反推出原來的訊息</li><li>雜湊值必須隨明文改變而改變。</li></ul><p>補充資源 : <a href="https://ithelp.ithome.com.tw/articles/10208884" target="_blank" rel="noreferrer">雜湊 (Hash)</a></p></div><hr><h3 id="🔻-step-3" tabindex="-1">🔻 Step. 3 <a class="header-anchor" href="#🔻-step-3" aria-label="Permalink to &quot;🔻 Step. 3&quot;">​</a></h3><ul><li>使用 jwt.io 的工具，得到以下資訊</li></ul><blockquote><p>header = <code>{&quot;alg&quot;: &quot;HS256&quot;}</code> payload = <code>{&quot;sub&quot;: &quot;guest&quot;}</code></p></blockquote><ul><li>根據原始碼，最終需要獲得 <em>secret</em> 並把 <code>sub</code> 改為 admin <ul><li>雜湊值是不可逆的，所以在此無法取得 key</li><li>換個思路，讓程式在讀取 <em>secret</em> 時繞過雜湊函式</li><li><em>secret</em> 的雜湊函式是根據 <em>header</em> 的 <code>alg</code>，將 <code>alg</code> 改為 none 即可</li><li>故最後修改為：</li></ul></li></ul><blockquote><p>header = <code>{&quot;alg&quot;: &quot;none&quot;}</code> payload = <code>{&quot;sub&quot;: &quot;admin&quot;}</code></p></blockquote><p><img src="https://hackmd.io/_uploads/BJLzhKhC6.png" alt="image"></p><hr><h3 id="🔻-step-4" tabindex="-1">🔻 Step. 4 <a class="header-anchor" href="#🔻-step-4" aria-label="Permalink to &quot;🔻 Step. 4&quot;">​</a></h3><ul><li>使用 Base64 加密工具，取得以下資訊</li></ul><blockquote><p>header = <code>eyJhbGciOiAibm9uZSJ9</code> payload = <code>eyJzdWIiOiAiYWRtaW4ifQ</code></p></blockquote><ul><li>重新組成 <code>eyJhbGciOiAibm9uZSJ9.eyJzdWIiOiAiYWRtaW4ifQ.</code></li><li>修改封包或網址 <code>?j=eyJhbGciOiAibm9uZSJ9.eyJzdWIiOiAiYWRtaW4ifQ.</code></li></ul><p><img src="https://hackmd.io/_uploads/B1lw19hCT.png" alt="image"></p><hr><h3 id="🔅-其他參考資料" tabindex="-1">🔅 其他參考資料 <a class="header-anchor" href="#🔅-其他參考資料" aria-label="Permalink to &quot;🔅 其他參考資料&quot;">​</a></h3><blockquote><p>解題關鍵：<a href="https://blog.csdn.net/weixin_60719780/article/details/129344197" target="_blank" rel="noreferrer">JWT利用在ctfhub-easy_login拿到flag</a></p><p>基礎原理：<a href="https://medium.com/%E4%BC%81%E9%B5%9D%E4%B9%9F%E6%87%82%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88/jwt-json-web-token-%E5%8E%9F%E7%90%86%E4%BB%8B%E7%B4%B9-74abfafad7ba" target="_blank" rel="noreferrer">JWT(JSON Web Token) — 原理介紹</a></p><p>工具應用：<a href="https://jwt.io/" target="_blank" rel="noreferrer">jwt.io</a></p></blockquote><p>Tag: <code>CTF</code> <code>LINECTF 2024</code> <code>JWT</code> <code>Json Web Token</code> <code>Write Up</code></p></div></div></main><footer class="VPDocFooter" data-v-72115c32 data-v-9de1f3f5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-9de1f3f5><span class="visually-hidden" id="doc-footer-aria-label" data-v-9de1f3f5>Pager</span><div class="pager" data-v-9de1f3f5><a class="VPLink link pager-link prev" href="/writeups/file-crawler.html" data-v-9de1f3f5><!--[--><span class="desc" data-v-9de1f3f5>Previous page</span><span class="title" data-v-9de1f3f5>file-crawler</span><!--]--></a></div><div class="pager" data-v-9de1f3f5><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"zlKgPben\",\"writeups_file-crawler.md\":\"Bgkb22gL\",\"writeups_broken-login.md\":\"BWazgtYg\",\"writeups_jalyboy-baby.md\":\"B8d4Vje1\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"xiung's doc\",\"description\":\"Some documents\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"WriteUp\",\"link\":\"/writeups/broken-login\"}],\"sidebar\":{\"/writeups/\":[{\"text\":\"CyberEdu\",\"items\":[{\"text\":\"broken-login\",\"link\":\"/writeups/broken-login\"},{\"text\":\"file-crawler\",\"link\":\"/writeups/file-crawler\"}]},{\"text\":\"picoCTF\",\"items\":[]},{\"text\":\"Other\",\"items\":[{\"text\":\"jalyboy-baby\",\"link\":\"/writeups/jalyboy-baby\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>